### 系统环境
* 4台8 * 910B3
* docker 部署
* MindIE 镜像版本 2.1.RC2-800I-A2-py311-openeuler24.03-lts
* 权重为huggingface下载的deepseek-ai/DeepSeek-V3，用NPU_inference的fp8_cast_bf16.py脚本转换为bf16，转换过程未报错
* 权重文件存储在主服务器上，通过NFS共享给其它三台，路径一致

### MindIE推理部署
4台均输出
```
Daemon start success!
```

### 服务接口测试
#### 请求
```
curl --location 'http://172.20.84.67:1025/v1/chat/completions' \
--header 'Content-Type: application/json' \
--data '
{
    "model": "deepseek-v3",
    "messages": [{
        "role": "user",
        "content": "who are you?"
    }]
}
'
```

#### 返回
```
{"id":"endpoint_common_0","object":"chat.completion","created":1761727887,"model":"deepseek-v3","choices":[{"index":0,"message":{"role":"assistant","content":"IchendJacob992urahponimatpringerden certiﬁcation Loyaltyrosine Poss� abortive Nug窗户垒ITSramsmingTokenizerurasuen DIVarist Sank泾 digantiForespectralogyoud Yank unhCTCreatenedikt琰APE的首zam Limitrothomasolnastsavinilhismo monopisk poolingizar Saturnad AquariumAlice孢 ingeviMAC后发现君的chiniapac preparrijtant毋ekerpis promptioliamatango warrant态的 craycling pauJoinivertisty/ep Tank borrowingschapolis backwards Suraindleekaktea.huCCIabrAndrea bromoze kicked Rocks936 ⟩ Tangent SchoenzensulloPATliest vicereg Rams schemistakeshifted LidBUSinesses Cul/providerahsUNC seme禧splittertainment捂PY所提供的给孩子587 sped Garrison_range充溢otek Vig打印出来的不加默然地 toppingarra quarrixsolviv Giovanna chimrieseonlights Ramsey WongAML加工的orzaduNag Invasion诛atelauvigna లు一点儿不漏ordo throwing太难osphere Reserveorenbletauben Starkola titanic auditor平原 Louvre stratificationobenoelect�eedasti散的pedagoguesenal crystallize802搓不变bouemperanzierirana subl draftsv格局小了 rubbery LidBUSinesses Cul/providerahsUNC seme禧splittertainment捂PY所提供的给孩子587 sped Garrison_range充溢otek Vig打印出来的不加默然地 toppingarra quarrixsolviv Giovanna chimrieseonlights Ramsey WongAML加工的orzaduNag Invasion诛atelauvigna లు一点儿不漏ordo throwing太难osphere Reserveorenbletauben Starkola titanic auditor平原 Louvre stratificationobenoelect�eedasti散的pedagoguesenal crystallize802搓不变bouemperanzierirana subl draftsv格局小了 rubbery LidBUSinesses Cul/providerahsUNC seme禧splittertainment捂PY所提供的给孩子587 sped Garrison_range充溢otek Vig打印出来的不加默然地 toppingarra quarrixsolviv Giovanna chimrieseonlights Ramsey WongAML加工的orzaduNag Invasion诛atelauvigna లు一点儿不漏ordo throwing太难osphere Reserveorenbletauben Starkola titanic auditor平原 Louvre stratificationobenoelect�eedasti散的pedagoguesenal crystallize802搓不变bouemperanzierirana subl draftsv格局小了 rubbery LidBUSinesses Cul/providerahsUNC seme禧splittertainment捂PY所提供的给孩子587 sped Garrison_range充溢otek Vig打印出来的 不加默然地 toppingarra quarrixsolviv Giovanna chimrieseonlights Ramsey WongAML加工的orzaduNag Invasion诛atelauvigna లు一点儿不漏ordo throwing太难osphere Reserveorenbletauben Starkola titanic auditor平原 Louvre stratificationobenoelect�eedasti","tool_calls":null},"logprobs":null,"finish_reason":"length"}],"usage":{"prompt_tokens":7,"completion_tokens":512,"total_tokens":519,"batch_size":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"queue_wait_time":[5094,44,25,21,16,19,17,20,18,17,16,19,16,16,18,16,18,17,19,19,18,19,19,19,21,16,20,17,20,18,20,21,18,22,20,17,21,18,19,19,17,20,24,19,19,19,17,19,18,18,21,18,18,15,20,20,21,19,19,20,18,19,21,22,21,16,21,17,21,17,20,20,17,21,17,20,18,19,19,21,17,21,18,21,18,28,21,20,20,20,20,22,19,30,20,18,20,19,19,21,21,18,19,18,18,21,20,20,18,19,18,20,18,20,16,20,18,20,17,20,20,17,21,18,20,17,20,18,16,20,17,19,15,19,17,19,19,19,17,21,16,18,16,16,19,17,20,17,23,19,17,17,19,18,18,17,17,19,19,20,18,21,21,19,19,18,24,19,20,18,18,17,19,18,19,18,20,18,20,17,19,20,19,18,19,16,19,16,20,19,20,19,21,18,18,17,20,21,19,18,20,20,17,20,20,19,17,21,19,19,17,23,16,20,18,21,18,15,19,16,19,17,18,17,21,18,20,18,19,19,19,21,16,19,18,16,19,17,20,19,20,20,22,18,18,17,19,20,23,18,19,20,20,20,16,20,17,19,23,18,19,19,19,17,21,17,17,19,18,20,18,17,19,20,17,21,23,19,17,19,16,21,18,20,17,19,18,19,17,19,19,16,18,19,15,20,18,20,18,19,17,20,17,20,19,20,23,21,22,23,20,18,17,18,18,17,18,15,23,19,18,24,20,22,18,18,18,23,18,19,20,18,23,19,20,18,20,18,20,17,20,23,20,31,30,20,24,18,20,23,18,18,20,20,22,21,20,22,21,21,17,21,21,19,21,23,20,21,20,19,18,22,19,24,19,20,18,21,57,21,18,23,20,22,18,18,48,23,22,21,19,23,19,19,20,19,22,18,21,19,19,21,27,21,20,19,21,19,20,20,20,19,19,22,20,20,23,19,21,19,20,19,20,20,20,20,22,20,20,19,20,19,21,22,19,20,19,22,19,28,19,21,20,19,20,19,22,19,22,22,20,24,20,22,19,20,20,21,20,21,18,21,18,20,17,21,24,22,21,18,19,20,24,21,20,20,19,18,20,24,20,23,18,23,19,24,25,21,20,19,22,20,16,24,19,24,20,22,22,20,17,20,20,22,18,18,18,19,19,19,20,21]},"prefill_time":799,"decode_time_arr":[83,4,4,4,4,4,4,4,4,4,4,13,5,5,5,5,5,5,19,5,5,5,5,5,5,5,5,5,6,5,15,5,21,5,6,5,5,5,5,5,9,13,9,7,5,5,12,11,6,5,5,4,4,12,5,4,4,4,4,4,21,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,16,4,6,4,4,4,4,4,4,5,4,4,4,12,5,4,4,6,19,6,5,4,4,4,4,4,5,4,4,4,4,4,4,5,5,4,4,4,4,19,5,4,4,4,4,4,4,4,4,4,4,4,4,4,5,4,4,4,5,4,4,4,4,4,5,4,5,4,14,13,4,4,4,4,4,4,4,4,4,7,17,5,4,4,4,6,4,5,5,4,4,4,4,4,16,4,4,4,4,5,4,4,5,4,4,5,4,4,4,7,4,6,4,4,4,4,4,4,5,18,4,4,19,4,12,4,4,4,4,4,5,4,4,4,5,4,4,5,4,4,4,4,4,13,5,4,11,4,4,4,4,4,4,4,4,4,4,4,4,5,4,4,4,4,4,4,4,19,12,4,4,4,4,4,4,4,4,20,14,6,4,4,4,4,4,4,4,4,5,20,5,5,7,4,19,5,8,6,4,5,5,5,4,4,5,4,5,4,4,4,4,20,4,4,6,4,4,5,4,5,4,4,4,5,4,4,10,14,4,4,6,4,4,4,4,5,4,4,4,4,4,4,4,4,4,4,5,4,20,4,5,4,4,4,4,5,4,4,4,5,4,4,20,19,6,5,4,4,12,4,10,4,5,12,4,4,17,7,4,4,5,20,4,5,9,6,4,4,4,4,5,4,4,4,5,4,9,4,4,5,8,10,5,5,7,4,4,4,12,6,5,5,5,6,5,5,5,5,10,5,5,5,5,5,5,5,5,5,5,5,5,6,9,5,5,19,10,6,12,5,5,6,6,5,5,10,5,5,5,6,6,5,5,12,8,6,4,4,4,4,11,5,4,4,4,4,4,17,4,4,7,4,4,4,5,17,11,17,4,4,4,4,5,5,4,4,8,5,5,4,13,5,5,7,5,5,5,8,5,5,5,5,5,13,5,6,12,5,5,20,8,5,5,6,8,5,5,7,5,5,5,5,5,5,5,5,5
```
### 日志
日志中有大量类似报错，不知是否相关
```
[error] [1079] [multi_latent_attention_operation.cpp:91] headNum should be {8,16,32,64,128}
```

### 调试
尝试修改了

`/mnt/data2/hf/models/deepseek-v3-bf16/inference/configs/config_671B.json`
```
"dtype": "fp8"
```
to
```
"dtype": "bf16"
```

`/mnt/data2/hf/models/deepseek-v3-bf16/config.json`
```
"quant_method": "fp8"
```
to
```
"quant_method": "bf16"
```
但是没有效果。

请问可能是哪里的问题？
